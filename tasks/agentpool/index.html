<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Agent Pools | Azure Container Registry</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/acr/assets/css/0.styles.6109ffbd.css" as="style"><link rel="preload" href="/acr/assets/js/app.72437028.js" as="script"><link rel="preload" href="/acr/assets/js/2.abe4a776.js" as="script"><link rel="preload" href="/acr/assets/js/24.49c04d3d.js" as="script"><link rel="prefetch" href="/acr/assets/js/10.29e034bd.js"><link rel="prefetch" href="/acr/assets/js/11.2306866a.js"><link rel="prefetch" href="/acr/assets/js/12.8a0e2aa4.js"><link rel="prefetch" href="/acr/assets/js/13.c5c29482.js"><link rel="prefetch" href="/acr/assets/js/14.7c7cea5b.js"><link rel="prefetch" href="/acr/assets/js/15.e893a25f.js"><link rel="prefetch" href="/acr/assets/js/16.7fbd1c37.js"><link rel="prefetch" href="/acr/assets/js/17.7b4ca9be.js"><link rel="prefetch" href="/acr/assets/js/18.00f91bd2.js"><link rel="prefetch" href="/acr/assets/js/19.cc15f323.js"><link rel="prefetch" href="/acr/assets/js/20.1d931ca0.js"><link rel="prefetch" href="/acr/assets/js/21.8bd98f6d.js"><link rel="prefetch" href="/acr/assets/js/22.b042e698.js"><link rel="prefetch" href="/acr/assets/js/23.ce60b122.js"><link rel="prefetch" href="/acr/assets/js/25.d73c849d.js"><link rel="prefetch" href="/acr/assets/js/26.8a4eb5f3.js"><link rel="prefetch" href="/acr/assets/js/27.74697b61.js"><link rel="prefetch" href="/acr/assets/js/28.c647ac2e.js"><link rel="prefetch" href="/acr/assets/js/29.807b58b9.js"><link rel="prefetch" href="/acr/assets/js/3.dc7b599c.js"><link rel="prefetch" href="/acr/assets/js/30.f9734c82.js"><link rel="prefetch" href="/acr/assets/js/31.f95e37b2.js"><link rel="prefetch" href="/acr/assets/js/32.b01df464.js"><link rel="prefetch" href="/acr/assets/js/33.16624aab.js"><link rel="prefetch" href="/acr/assets/js/34.f62ff759.js"><link rel="prefetch" href="/acr/assets/js/35.19456f29.js"><link rel="prefetch" href="/acr/assets/js/4.85c29c20.js"><link rel="prefetch" href="/acr/assets/js/5.7b12d3a2.js"><link rel="prefetch" href="/acr/assets/js/6.8358fbe8.js"><link rel="prefetch" href="/acr/assets/js/7.dc32a1c7.js"><link rel="prefetch" href="/acr/assets/js/8.525ca08d.js"><link rel="prefetch" href="/acr/assets/js/9.ac9d72fd.js">
    <link rel="stylesheet" href="/acr/assets/css/0.styles.6109ffbd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acr/" class="home-link router-link-active"><img src="/acr/files/acr.svg" alt="Azure Container Registry" class="logo"> <span class="site-name can-hide">Azure Container Registry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azure/acr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/acr/" aria-current="page" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/#blog-posts" class="sidebar-link">Blog posts</a></li><li class="sidebar-sub-header"><a href="/acr/#links" class="sidebar-link">Links</a></li><li class="sidebar-sub-header"><a href="/acr/#providing-feedback" class="sidebar-link">Providing feedback</a></li><li class="sidebar-sub-header"><a href="/acr/#api-and-sdk-reference" class="sidebar-link">API and SDK reference</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Teleport</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Tasks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/acr/tasks/container-registry-tasks-overview.html" class="sidebar-link">Automate OS and Framework Patching with Azure Container Registry Tasks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/tasks/container-registry-tasks-overview.html#acr-build-and-acr-tasks" class="sidebar-link">ACR Build and ACR Tasks</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/container-registry-tasks-overview.html#acr-task-common-scenarios" class="sidebar-link">ACR Task Common Scenarios</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/container-registry-tasks-overview.html#acr-tasks-support-the-3-primary-phases-of-development" class="sidebar-link">ACR Tasks Support the 3 Primary Phases of Development</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/container-registry-tasks-overview.html#acr-tasks-support-simple-to-complex-workloads-integrating-with-ci-cd-solutions" class="sidebar-link">ACR Tasks Support Simple to Complex Workloads, Integrating with CI/CD Solutions</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/container-registry-tasks-overview.html#acr-tasks-preview-feedback" class="sidebar-link">ACR Tasks Preview Feedback</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/container-registry-tasks-overview.html#next-steps" class="sidebar-link">Next steps</a></li></ul></li><li><a href="/acr/tasks/run-as-deployment/" class="sidebar-link">Deploy with ARM templates</a></li><li><a href="/acr/tasks/agentpool/" aria-current="page" class="active sidebar-link">Agent Pools</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acr/tasks/agentpool/#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/agentpool/#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/agentpool/#create-and-manage-an-acr-task-agent-pool" class="sidebar-link">Create and Manage an ACR Task Agent Pool</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/agentpool/#create-an-agent-pool-in-a-vnet" class="sidebar-link">Create an Agent Pool in a VNet</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/agentpool/#schedule-runs-on-the-agent-pool" class="sidebar-link">Schedule Runs on the Agent Pool</a></li><li class="sidebar-sub-header"><a href="/acr/tasks/agentpool/#preview-limitations" class="sidebar-link">Preview Limitations</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Authentication</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Integration</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="running-acr-tasks-on-dedicated-agent-pools"><a href="#running-acr-tasks-on-dedicated-agent-pools" class="header-anchor">#</a> Running ACR Tasks on Dedicated Agent Pools</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>ACR Task Agent Pool provides <a href="https://aka.ms/acr/tasks" target="_blank" rel="noopener noreferrer">ACR Task<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> execution in dedicated machine pools.</p> <p>Task Agent Pools provide:</p> <ul><li><strong>VNet Support:</strong> Agent Pools may be assigned to Azure VNets, providing access the resources in the VNet (eg, Container Registry, Key Vault, Storage).</li> <li><strong>Scale As Needed:</strong> Agent pools can be increased as needed, or scaled to zero, billed based on allocation.</li> <li><strong>More Memory and CPU Options:</strong> The current preview provides 3 standard tiers, S1 (2 cpu, 3G mem), S2 (4 cpu, 8G mem), and S3 (8 cpu, 16G mem) and 1 isolated tier, I6 (64 cpu, 216G mem).</li> <li><strong>Agent Pools per Workload:</strong> To serve different configurations, instance agent pools based on scale and tier options to serve different types of workloads.</li> <li><strong>Hybrid Managed Pools:</strong> Task pools are patched and maintained by Azure. Task pools provide a balance between reserved allocation without the need to maintain the individual VMs.</li></ul> <p>ACR Task Agent Pools are currently previewed in WestUS2, SouthCentralUS, EastUS2 and EastUS.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" target="_blank" rel="noopener noreferrer">Azure CLI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <strong>2.3.1</strong> or above.</li> <li>A <a href="https://aka.ms/acr/tiers" target="_blank" rel="noopener noreferrer"><strong>premium</strong> container registry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in the above preview regions.</li></ul> <h2 id="create-and-manage-an-acr-task-agent-pool"><a href="#create-and-manage-an-acr-task-agent-pool" class="header-anchor">#</a> Create and Manage an ACR Task Agent Pool</h2> <ul><li>Set the default registry, simplifying CLI commands</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>az configure --defaults <span class="token assign-left variable">acr</span><span class="token operator">=</span><span class="token punctuation">[</span>registryName<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>Create an agent pool of tier S2 (4 cpu/instance) with 1 instance.</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>az acr agentpool create <span class="token punctuation">\</span>
    --name myagentpool <span class="token punctuation">\</span>
    --tier S2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>Scale the agent pool with more instances or scale in to 0.</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>az acr agentpool update <span class="token punctuation">\</span>
    --name myagentpool <span class="token punctuation">\</span>
    --count <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="create-an-agent-pool-in-a-vnet"><a href="#create-an-agent-pool-in-a-vnet" class="header-anchor">#</a> Create an Agent Pool in a VNet</h2> <ul><li>Task Agent Pools require access to the following Azure services. The following firewall rules must be added to any existing network security groups or user-defined routes.</li></ul> <table><thead><tr><th>Direction</th> <th>Protocol</th> <th>Source</th> <th>Source Port</th> <th>Destination</th> <th>Dest Port</th> <th>Used</th></tr></thead> <tbody><tr><td>Outbound</td> <td>TCP</td> <td>VirtualNetwork</td> <td>Any</td> <td>AzureKeyVault</td> <td>443</td> <td>Default</td></tr> <tr><td>Outbound</td> <td>TCP</td> <td>VirtualNetwork</td> <td>Any</td> <td>Storage</td> <td>443</td> <td>Default</td></tr> <tr><td>Outbound</td> <td>TCP</td> <td>VirtualNetwork</td> <td>Any</td> <td>EventHub</td> <td>443</td> <td>Default</td></tr> <tr><td>Outbound</td> <td>TCP</td> <td>VirtualNetwork</td> <td>Any</td> <td>AzureActiveDirectory</td> <td>443</td> <td>Default</td></tr> <tr><td>Outbound</td> <td>TCP</td> <td>VirtualNetwork</td> <td>Any</td> <td>AzureMonitor</td> <td>443</td> <td>Default</td></tr></tbody></table> <p>[NOTE] If your Tasks require additional resources from public internet, eg, if you run docker build task that needs to pull the base images from DockerHub or restore Nuget package, please add the corresponding rules.</p> <ul><li>Create an agent pool in the VNet.</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token assign-left variable">subnet</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>az network vnet subnet show <span class="token punctuation">\</span>
        -g myvnetresourcegroup <span class="token punctuation">\</span>
        --vnet-name myvnetname <span class="token punctuation">\</span>
        -n mysubnetname <span class="token punctuation">\</span>
        --query <span class="token function">id</span> -o tsv<span class="token variable">)</span></span>

az acr agentpool create <span class="token punctuation">\</span>
    --name myagentpool <span class="token punctuation">\</span>
    --tier S2 <span class="token punctuation">\</span>
    --subnet-id <span class="token variable">$subnet</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="schedule-runs-on-the-agent-pool"><a href="#schedule-runs-on-the-agent-pool" class="header-anchor">#</a> Schedule Runs on the Agent Pool</h2> <ul><li>Schedule a quick run on the agent pool.</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>az acr build <span class="token punctuation">\</span>
    --agent-pool myagentpool <span class="token punctuation">\</span>
    -t myimage:mytag <span class="token punctuation">\</span>
    -f Dockerfile <span class="token punctuation">\</span>
    https://github.com/Azure-Samples/acr-build-helloworld-node.git
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>Create a recurring task on the agent pool.</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>az acr task create <span class="token punctuation">\</span>
    -n mytask <span class="token punctuation">\</span>
    --agent-pool myagentpool <span class="token punctuation">\</span>
    -t myimage:mytag <span class="token punctuation">\</span>
    -f Dcokerfile <span class="token punctuation">\</span>
    -c https://github.com/Azure-Samples/acr-build-helloworld-node.git <span class="token punctuation">\</span>
    --commit-trigger-enabled <span class="token boolean">false</span>

az acr task run <span class="token punctuation">\</span>
    -r mypremiumregistry <span class="token punctuation">\</span>
    -n mytask
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>Query the agent pool queue status (current scheduled runs on the agent pool).</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>az acr agentpool show <span class="token punctuation">\</span>
    -n myagentpool <span class="token punctuation">\</span>
    --queue-count
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="preview-limitations"><a href="#preview-limitations" class="header-anchor">#</a> Preview Limitations</h2> <ul><li>Task Agent Pools currently support Linux nodes. Windows nodes are not currently supported.</li> <li>For each registry, the default total cpu quota of all standard agent pools is 16 and all isolated agent pools is 0. Please <a href="https://aka.ms/acr/support/create-ticket" target="_blank" rel="noopener noreferrer">open a support ticket<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for additional allocation.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azure/acr/edit/master/docs/tasks/agentpool/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/acr/tasks/run-as-deployment/" class="prev">
        Deploy with ARM templates
      </a></span> <span class="next"><a href="/acr/AAD-OAuth.html">
        AAD Integration
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/acr/assets/js/app.72437028.js" defer></script><script src="/acr/assets/js/2.abe4a776.js" defer></script><script src="/acr/assets/js/24.49c04d3d.js" defer></script>
  </body>
</html>
